<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ëŒ€ì „ ì „ë ¥ ì‚¬ìš©ëŸ‰</title>
</head>
<style>
    body {
      margin: 0;
      font-family: 'Segoe UI', sans-serif;
    }
    /* í—¤ë” ì‹œì‘ */
    header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 15px 30px;
      background-color: #f8f8f8;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
    }

    .logo-site {
      display: flex;
      align-items: center;
    }
    /* ë‚´ë¹„ ë¡œê³  */
    #header_logo {
      width: 40px;
    }

    .site-name {
      font-size: 1.7rem;
      font-weight: bold;
    }

    nav {
      margin-left: 10px; /* ì‚¬ì´íŠ¸ëª…ê³¼ ë©”ë‰´ ì‚¬ì´ ê°„ê²© */
    }

    .menu {
      display: flex;
      gap: 60px;
      margin-right: 120px;
    }
    /* ë‚´ë¹„ ë©”ë‰´ ë§í¬ */
    .menu a {
      text-decoration: none;
      color: #333;
      font-size: 1.3rem;
      transition: color 0.3s;
      font-weight: bold;
    }
    /* ë‚´ë¹„ ë©”ë‰´ ì»¤ì„œ íš¨ê³¼ */
    .menu a:hover {
      color: #2B8122;
    }

    @media (max-width: 768px) {
      header {
        flex-direction: column;
        align-items: flex-start;
      }

      nav {
        margin-left: 0;
        margin-top: 10px;
      }

      .menu {
        flex-direction: column;
        gap: 10px;
      }
    }
     /* main ì‹œì‘*/
    main {
        margin-left: 150px;
        margin-right: 150px;
    }
    .title{
        margin-top: 40px; /* í—¤ë”ì™€ì˜ ê°„ê²© ì¶”ê°€ */
    }
    .main-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .page-title {
        font-size: 2.5rem;
        font-weight: bold;
        margin: 0;
    }

    /* ì•„ì´ì½˜ ì¶”ê°€ ì‹œ í¬ê¸° ì¡°ì ˆì´ë‚˜ ì—¬ë°± ì¡°ì ˆ ê°€ëŠ¥ */
    .icon-area img {
      width: 120px;
    }
    /* íƒ€ì´í‹€ ì œëª© ê¸€ì”¨ ìƒ‰ ë³€ê²½ */
    .highlight {
    color: #D52F2F;
    }

    .content-area {
      display: flex;
      margin-top: 40px;
      gap: 40px;
      margin-bottom: 40px;
    }
    .map-box, .graph-box {
      flex: 1;
      /* border: 2px solid #ddd; */
      border-radius: 12px;
      padding: 20px;
      background-color: #ffe0e0;
      box-shadow: 0 0 10px rgba(0,0,0,0.05);
      max-width: 800px;
      fill: none;
    }
    .map-box {
      display: flex;
      justify-content: center;
      align-items: center;
    }
/* .map-box svg path {
      fill: #d0e4f7;
      stroke: #333;
      stroke-width: 1;
      transition: all 0.3s ease;
      cursor: pointer;
    } */
    /* .map-box svg path:hover {
      transform: scale(1.05);
      fill: #a5d2ff;
    } */
    /* ì „ì²´ wrapper - ìƒëŒ€ ìœ„ì¹˜ ì„¤ì • */
    .graph-container {
        position: relative;
        display: flex;
        flex-direction: column;
        align-items: flex-end; /* ì˜¤ë¥¸ìª½ ì •ë ¬ */
        margin-top: 20px;
    }

    /* ë²„íŠ¼ì„ ë°•ìŠ¤ ë°”ê¹¥ ì™¼ìª½ ìƒë‹¨ì— ìœ„ì¹˜ */
    .graph-tabs {
        position: absolute;
        top: -34px;
        left: 0;
        display: flex;
        z-index: 0;  /* ê·¸ë˜í”„ ë°•ìŠ¤ ë’¤ì— ìœ„ì¹˜í•˜ë„ë¡ ë‚®ì¶¤ */
    }

    /* íƒ­ ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
    .tab-btn {
        background-color: #F5A4B5;
        border: none;
        padding: 8px 40px;
        font-size: 1.1rem;
        font-weight: bold;
        border-radius: 8px 8px 0 0;
        cursor: pointer;
        color: black;
    }

    .tab-btn.active {
        background-color: #E06B84;
        color: black;
    }

    .tab-btn:hover {
        background-color: #E06B84;
    }

    .tab-btn.active:hover {
        background-color: #f1869d;
    }

    /* ê·¸ë˜í”„ ë°•ìŠ¤ */
    .graph-box {
        position: relative;
        width: 100%;
        background-color: #fff3f3;
        border: 3px solid #E9A7A1;
        border-radius: 10px;
        padding: 20px;
        box-sizing: border-box;
        z-index: 1;  /* ë²„íŠ¼ë³´ë‹¤ ìœ„ì— ì˜¬ë¼ì˜¤ê²Œ ë†’ê²Œ ì„§ì • */
    }

    .graph-header {
        display: flex;
        /* justify-content: space-between; */
        align-items: center;
        margin-bottom: 80px;
    }

    .graph-title {
        font-weight: bold;
        font-size: 1.1rem;
        margin-right: 20px;
    }

    .year-select {
        padding: 6px 12px;
        font-size: 0.95rem;
        border: 1px solid #ccc;
        border-radius: 8px;
        background-color: #fff;
        color: #333;
        outline: none;
        background-repeat: no-repeat;
        background-position: right 10px center;
        background-size: 16px;
        cursor: pointer;
    }

    /* ì§€ë„ */
    #svg-container {
        width: 100%;
        max-width: 600px;
        margin: 0 auto;
        display: flex;
        justify-content: center;
        align-items: center;
    }
    #svg-container svg {
      display: block;
      margin: auto;
      width: 100%;
      height: auto;
    }

    .hover-target {
        cursor: pointer;
        transition: transform 0.05s ease-out, fill 0.05s ease-out;
        will-change: transform, fill;
    }

    .hover-target:hover {
        transform: translateY(4px);
        fill: #F5A4B5;
    }
    .back-btn img {
      width: 24px;
      height: 24px;
      object-fit: contain;
    }
    .back-btn {
      background: none;
      border: none;
      cursor: pointer;
      margin-right: 10px;
      padding: 4px;
      transition: transform 0.2s ease;
    }
    .back-btn:hover {
      transform: scale(1.1);
    }
    .graph-content {
    position: relative;
    padding: 20px;
    background-color: #fff;
    border-radius: 10px;
    box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
  }

  #powerUsageChart {
    width: 100%;
    height: 400px;
  }
  /* ===== í‘¸í„° ===== */
	footer {
    text-align: center;
    padding: 8px 0;
    font-size: 0.85rem;
    color: #666;
    background-color: #f8f8f8;
    width: 100%;
    margin-top: auto;
    box-shadow: 0 3px 5px rgba(0, 0, 0, 0.8);
  } 		

</style>
<body>
    <header>
    <div class="logo-site">
		<a href="/" style="display: flex; align-items: center; text-decoration: none; color: inherit;">
		   <div class="logo"><img src="./icon/ë©”ì¸ë¡œê³ _ë°°ê²½íˆ¬ëª…í™”.png" id="header_logo"></div>
		   <div class="site-name">A.P.T</div>
		</a>
    </div>
    <nav>
      <div class="menu">
        <a href="calculation">ëŒ€ê¸°ì „ë ¥ ê³„ì‚°</a>
        <a href="/dashboard">ì „ë ¥ ì‚¬ìš©ëŸ‰ í†µê³„</a>
        <a href="/feeCompare">ì „ë ¥ ì‚¬ìš©ëŸ‰ ë¹„êµ</a>
        <a href="/product">ê°€ì „ ì œí’ˆ ì¶”ì²œ</a>
      </div>
    </nav>
  </header>
  <main>
    <section class="title">
        <div class="main-header">
            <h1 class="page-title">
                ìš°ë¦¬ ë™ë„¤ì˜<br><span class="highlight">ì „ë ¥ ì‚¬ìš©ëŸ‰</span>ì€?
              </h1>
            <div class="icon-area">
              <img class="fa-solid fa-gear" src="./icon/ë©”ì¸_í†µê³„.png">
            </div>
          </div>
    </section>
    <section class="content-area">
      <div class="map-box">
        <div id="svg-container"></div>
      </div>

    <div class="graph-container">
    <div class="graph-tabs">
            <button class="tab-btn active">ì›”ë³„</button>
            <button class="tab-btn">ì˜ˆì¸¡</button>
        </div>
        <div class="graph-box">
			<div class="graph-header">
			  <button class="back-btn" title="ì§€ë„ ë‹¤ì‹œ ë³´ê¸°">
			    <img src="./icon/ìš°ë¦¬ë™ë„¤_ë’¤ë¡œê°€ê¸°.png">
			  </button>
			  <span class="graph-title">ì„œêµ¬ ì „ë ¥ ì‚¬ìš©ëŸ‰</span>
			  <input type="number" class="year-select" min="2015" max="2030" value="2024" />
			</div>
            <div class="graph-content">
            <canvas id="powerUsageChart"></canvas>
            </div>
        </div>
    </div>
    </section>
  </main>
  <!-- í‘¸í„° -->
    <footer>
        <p>Â© 2025 A.P.T All rights reserved.</p>
        <p>Made with ğŸ–¥ï¸ by E.F</p>
    </footer>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
  let chartInstance = null;
  // ê¸°ë³¸ ì§€ì—­ ì„¤ì • (í˜ì´ì§€ ë¡œë“œ ì‹œ)
  const initialRegion = "ì„œêµ¬";

  function renderChart(labels, data) {
    const ctx = document.getElementById("powerUsageChart").getContext("2d");

    if (chartInstance) {
      chartInstance.destroy();
    }

    chartInstance = new Chart(ctx, {
      type: "line",
      data: {
        labels: labels,
        datasets: [{
          label: "ì›”ë³„ ì „ë ¥ ì‚¬ìš©ëŸ‰ (kWh)",
          data: data,
          borderColor: "#FF5733",
          backgroundColor: "rgba(255, 87, 51, 0.2)",
          borderWidth: 2,
          fill: true,
          tension: 0.4,
        }],
      },
      options: {
        responsive: true,
        plugins: {
          legend: { position: "top" },
          tooltip: {
            backgroundColor: "#333",
            titleColor: "#fff",
            bodyColor: "#fff",
            cornerRadius: 5,
          }
        },
        scales: {
          x: {
            title: {
              display: true,
              text: "ì›”",
              color: "#333",
              font: { size: 14 },
            },
            grid: { display: false },
          },
          y: {
            title: {
              display: true,
              text: "ì „ë ¥ ì‚¬ìš©ëŸ‰ (kWh)",
              color: "#333",
              font: { size: 14 },
            },
            beginAtZero: true,
            grid: { borderColor: "#ccc" },
          }
        }
      }
    });
  }

  // âœ¨ ì‹¤ì œ ë°ì´í„° ê°€ì ¸ì˜¤ëŠ” í•¨ìˆ˜ (Flask /actual_power_usage í˜¸ì¶œ)
  function fetchActualData(region, year) {
      console.log(`--- ì‹¤ì œ ë°ì´í„° ìš”ì²­ ì‹œì‘ ---`);
      console.log(`ìš”ì²­ ì§€ì—­: ${region}, ìš”ì²­ ì—°ë„: ${year}`);
      fetch(`http://192.168.0.17:5000/actual_power_usage?district=${region}&year=${year}`, {
        method: "GET",
        headers: {
          "Content-Type": "application/json",
        },
      })
        .then((res) => {
            if (!res.ok) {
                throw new Error(`HTTP error! status: ${res.status}`);
            }
            return res.json();
        })
        .then((json) => {
          if (json.error) {
            console.error("ì‹¤ì œ ë°ì´í„° ì˜¤ë¥˜:", json.error);
            renderChart([], []); // ì—ëŸ¬ ë°œìƒ ì‹œ ë¹ˆ ê·¸ë˜í”„
            alert(`ì‹¤ì œ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ëŠ” ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤: ${json.error}`);
          } else if (json.monthly_actual_data) {
            // --- ì´ ë¶€ë¶„ ìˆ˜ì •: 1ì›”ë¶€í„° 12ì›”ê¹Œì§€ ìˆœì„œ ë³´ì¥ ---
            const monthlyData = json.monthly_actual_data;
            const labels = [];
            const values = [];

            for (let i = 1; i <= 12; i++) {
                labels.push(`${i}ì›”`);
                // í•´ë‹¹ ì›”ì˜ ë°ì´í„°ê°€ ì—†ìœ¼ë©´ 0.0ìœ¼ë¡œ ì²˜ë¦¬ (Flaskì—ì„œ ì´ë¯¸ ì²˜ë¦¬í•˜ì§€ë§Œ, í´ë¼ì´ì–¸íŠ¸ì—ì„œ í•œ ë²ˆ ë” ì•ˆì •ì„± í™•ë³´)
                values.push(monthlyData[`${i}ì›”`] || 0.0);
            }
            // --- ìˆ˜ì • ë ---

            console.log(`--- ì‹¤ì œ ë°ì´í„° ìˆ˜ì‹  ì™„ë£Œ ---`);
            console.log(`ì§€ì—­: ${json.district}, ì—°ë„: ${json.year}`);
            console.log("ì›”ë³„ ë°ì´í„° (ì‹¤ì œ - ì •ë ¬ë¨):", monthlyData); // ì›ë˜ ê°ì²´ëŠ” ê·¸ëŒ€ë¡œ ì¶œë ¥, Chart.jsì— ì „ë‹¬í•  ë°ì´í„°ëŠ” ì •ë ¬ëœ labelsì™€ values
            renderChart(labels, values);
          } else {
            console.error("ì‹¤ì œ ë°ì´í„° í˜•ì‹ì´ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤:", json);
            renderChart([], []);
          }
        })
        .catch((err) => {
          console.error("ì‹¤ì œ ë°ì´í„° ìš”ì²­ ì‹¤íŒ¨:", err);
          renderChart([], []);
          alert(`ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ ë˜ëŠ” ì„œë²„ ì‘ë‹µ ë¬¸ì œ: ${err.message}`);
        });
    }

  // ì˜ˆì¸¡ ë°ì´í„° ê°€ì ¸ì˜¤ëŠ” í•¨ìˆ˜ (Flask /predict_json í˜¸ì¶œ)
  function fetchPredictedData(region, year) {
      console.log(`--- Flask ì˜ˆì¸¡ ë°ì´í„° ìš”ì²­ ì‹œì‘ ---`);
      console.log(`ìš”ì²­ ì§€ì—­: ${region}, ìš”ì²­ ì—°ë„: ${year}`);
      fetch("http://192.168.0.17:5000/predict_json", {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
        },
        body: JSON.stringify({
          district: region,
          year: parseInt(year) // Flaskì—ì„œ ìˆ«ìë¡œ ë°›ë„ë¡ parseInt ì‚¬ìš©
        }),
      })
        .then((res) => {
            if (!res.ok) {
                throw new Error(`HTTP error! status: ${res.status}`);
            }
            return res.json();
        })
        .then((json) => {
          if (json.error) {
            console.error("ì˜ˆì¸¡ ë°ì´í„° ì˜¤ë¥˜:", json.error);
            renderChart([], []); // ì—ëŸ¬ ë°œìƒ ì‹œ ë¹ˆ ê·¸ë˜í”„
            alert(`ì˜ˆì¸¡ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ëŠ” ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤: ${json.error}`);
          } else if (json.monthly_predictions) {
            // --- ì´ ë¶€ë¶„ ìˆ˜ì •: 1ì›”ë¶€í„° 12ì›”ê¹Œì§€ ìˆœì„œ ë³´ì¥ ---
            const monthlyPredictions = json.monthly_predictions;
            const labels = [];
            const values = [];

            for (let i = 1; i <= 12; i++) {
                labels.push(`${i}ì›”`);
                // í•´ë‹¹ ì›”ì˜ ë°ì´í„°ê°€ ì—†ìœ¼ë©´ 0.0ìœ¼ë¡œ ì²˜ë¦¬
                values.push(monthlyPredictions[`${i}ì›”`] || 0.0);
            }
            // --- ìˆ˜ì • ë ---

            console.log(`--- Flask ì˜ˆì¸¡ ë°ì´í„° ìˆ˜ì‹  ì™„ë£Œ ---`);
            console.log(`ì§€ì—­: ${json.district}, ì—°ë„: ${json.year}`);
            console.log("ì›”ë³„ ë°ì´í„° (ì˜ˆì¸¡ - ì •ë ¬ë¨):", monthlyPredictions); // ì›ë˜ ê°ì²´ëŠ” ê·¸ëŒ€ë¡œ ì¶œë ¥, Chart.jsì— ì „ë‹¬í•  ë°ì´í„°ëŠ” ì •ë ¬ëœ labelsì™€ values
            renderChart(labels, values);
          } else {
            console.error("ì˜ˆì¸¡ ë°ì´í„° í˜•ì‹ì´ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤:", json);
            renderChart([], []);
          }
        })
        .catch((err) => {
          console.error("ì˜ˆì¸¡ ë°ì´í„° ìš”ì²­ ì‹¤íŒ¨:", err);
          renderChart([], []);
          alert(`ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ ë˜ëŠ” ì„œë²„ ì‘ë‹µ ë¬¸ì œ: ${err.message}`);
        });
    }


  function loadRegionSVG(filename, hoverIds = []) {
    fetch(filename)
      .then(res => res.text())
      .then(svgText => {
        const container = document.getElementById("svg-container");
        container.innerHTML = svgText;

        const svg = container.querySelector("svg");
        if (svg) {
          svg.removeAttribute("width");
          svg.removeAttribute("height");
          svg.setAttribute("viewBox", "0 0 1170 1355");
          svg.style.width = "100%";
          svg.style.height = "auto";
        }

        hoverIds.forEach(id => {
          const region = container.querySelector(`#${CSS.escape(id)}`);
          if (region) {
            region.classList.add("hover-target");

            region.addEventListener("mouseenter", () => {
              const tooltip = document.getElementById("tooltip");
              tooltip.textContent = "ğŸš© " + id;
              tooltip.style.display = "block";
            });

            region.addEventListener("mousemove", (e) => {
              const tooltip = document.getElementById("tooltip");
              tooltip.style.left = e.pageX + 10 + "px";
              tooltip.style.top = e.pageY + 10 + "px";
            });

            region.addEventListener("mouseleave", () => {
              document.getElementById("tooltip").style.display = "none";
            });

            region.addEventListener("click", () => {
            	// í´ë¦­í•œ êµ¬ì—­ì˜ SVG í¬ê¸° í‚¤ìš°ê¸° (ì „ì²´ SVG í¬ê¸°ë¥¼ í™•ëŒ€)
                const svgContainer = document.getElementById("svg-container");
                svgContainer.style.transition = "all 0.3s ease"; // ë¶€ë“œëŸ¬ìš´ íŠ¸ëœì§€ì…˜ íš¨ê³¼
                svgContainer.style.transform = "scale(2.2)"; // í¬ê¸°ë¥¼ 2.2ë°°ë¡œ í™•ëŒ€
                svgContainer.style.transformOrigin = "top center"; // ê¸°ì¤€ìœ¼ë¡œ í™•ëŒ€

              // í´ë¦­ëœ êµ¬ì—­ ì´ë¦„ìœ¼ë¡œ ê·¸ë˜í”„ ì œëª© ë³€ê²½
              document.querySelector(".graph-title").textContent = `${id} ì „ë ¥ ì‚¬ìš©ëŸ‰`;

              // í´ë¦­ëœ êµ¬ì—­ì— ëŒ€í•œ ì „ë ¥ ì‚¬ìš©ëŸ‰ ë°ì´í„° ìš”ì²­
              const selectedYear = document.querySelector(".year-select").value;
              const activeTab = document.querySelector(".tab-btn.active").textContent;
			  document.querySelector(".graph-title").textContent = `${id} ì „ë ¥ ì‚¬ìš©ëŸ‰`;
              console.log(`ì§€ë„ í´ë¦­! ì§€ì—­: ${id}, ì—°ë„: ${selectedYear}, íƒ­: ${activeTab}`);

			  if (id.endsWith("ë™")) {
			    requestPrediction(id, selectedYear);
			  } else {
			    if (activeTab === "ì›”ë³„") {
			      fetchActualData(id, selectedYear);
			    } else if (activeTab === "ì˜ˆì¸¡") {
			      fetchPredictedData(id, selectedYear);
			    }
			  }

              // í´ë¦­ëœ êµ¬ì—­ì— ë”°ë¼ í•˜ìœ„ í–‰ì •ë™ SVG ë¡œë“œ
              switch (id) {
                case "ëŒ€ë•êµ¬":
                  loadRegionSVG("/svg/ëŒ€ë•êµ¬_í–‰ì •ë™.svg", [
                    "ëŒ€í™”ë™", "ë•ì•”ë™", "ë¹„ë˜ë™", "ì„ë´‰ë™", "ì†¡ì´Œë™",
                    "ëª©ìƒë™", "ì‹ íƒ„ì§„ë™", "ì˜¤ì •ë™", "ë²•1ë™", "ë²•2ë™",
                    "ì¤‘ë¦¬ë™", "íšŒë•ë™"
                  ]);
                  break;
                case "ì„œêµ¬":
                  loadRegionSVG("/svg/ì„œêµ¬_í–‰ì •ë™.svg", [
                    "ë³µìˆ˜ë™", "ë„ë§ˆ1ë™", "ë„ë§ˆ2ë™", "ì •ë¦¼ë™", "ë³€ë™", "ìš©ë¬¸ë™", "íƒ„ë°©ë™",
                    "ë‘”ì‚°1ë™", "ë‘”ì‚°2ë™", "ê´´ì •ë™", "ê°€ì¥ë™", "ë‚´ë™", "ê°ˆë§ˆ1ë™", "ê°ˆë§ˆ2ë™",
                    "ì›”í‰1ë™", "ì›”í‰2ë™", "ì›”í‰3ë™", "ë§Œë…„ë™", "ê°€ìˆ˜ì›ë™", "ê¸°ì„±ë™",
                    "ê´€ì €1ë™", "ê´€ì €2ë™", "ë‘”ì‚°3ë™"
                  ]);
                  break;
                case "ìœ ì„±êµ¬":
                  loadRegionSVG("/svg/ìœ ì„±êµ¬_í–‰ì •ë™.svg", [
                    "ë…¸ì€1ë™", "ë…¸ì€2ë™", "ë…¸ì€3ë™", "ì˜¨ì²œ1ë™", "ì˜¨ì²œ2ë™", "ì›ì‹ í¥ë™",
                    "ì‹ ì„±ë™", "ì§„ì ë™", "êµ¬ì¦‰ë™", "í•™í•˜ë™", "ìƒëŒ€ë™", "ì „ë¯¼ë™", "ê´€í‰ë™"
                  ]);
                  break;
                case "ë™êµ¬":
                  loadRegionSVG("/svg/ë™êµ¬_í–‰ì •ë™.svg", [
				  	"ê°€ì–‘1ë™", "ê°€ì–‘2ë™", "ê°€ì˜¤ë™", "ëŒ€ë™", "ëŒ€ì²­ë™", "ì‚°ë‚´ë™", "ì‚¼ì„±ë™",
				    "ì„±ë‚¨ë™", "ì‹ ì¸ë™", "ì‹ í¥ë™", "ìš©ì „ë™", "ìì–‘ë™", "ì¤‘ì•™ë™",
				    "íŒì•”1ë™", "íŒì•”2ë™", "í™ë„ë™", "íš¨ë™", "ìš©ìš´ë™"
                  ]);
                  break;
                case "ì¤‘êµ¬":
                  loadRegionSVG("/svg/ì¤‘êµ¬_í–‰ì •ë™.svg", [
                    "ëŒ€ì‚¬ë™", "ëŒ€í¥ë™", "ëª©ë™", "ë¬¸ì°½ë™", "ë¬¸í™”1ë™", "ë¬¸í™”2ë™",
                    "ë¶€ì‚¬ë™", "ì‚°ì„±ë™", "ì„êµë™", "ì˜¤ë¥˜ë™", "ìš©ë‘ë™",
                    "ìœ ì²œ1ë™", "ìœ ì²œ2ë™", "ì€í–‰ì„ í™”ë™", "ì¤‘ì´Œë™",
                    "íƒœí‰1ë™", "íƒœí‰2ë™"
                  ]);
                  break;
                // í–‰ì •ë™ í´ë¦­ ì‹œì—ëŠ” í˜„ì¬ ê·¸ë˜í”„ë¥¼ ìœ ì§€í•˜ê±°ë‚˜, ë” ì„¸ë¶€ì ì¸ ë°ì´í„°ë¥¼ ë¡œë“œí•  ìˆ˜ ìˆìŒ
				default:
				  const selectedYear = document.querySelector(".year-select").value;
				  const activeTab = document.querySelector(".tab-btn.active").textContent;

				  console.log(`í–‰ì •ë™ í´ë¦­ë¨: ${id}, íƒ­: ${activeTab}, ì—°ë„: ${selectedYear}`);
				  break;
              }
            });
          }
        });
      });
  }


  document.addEventListener("DOMContentLoaded", () => {
    const defaultRegionIds = ["ìœ ì„±êµ¬", "ë™êµ¬", "ì„œêµ¬", "ì¤‘êµ¬", "ëŒ€ë•êµ¬"];
    loadRegionSVG("/svg/ëŒ€ì „_í–‰ì •êµ¬ì—­3_ì •ì œë¨.svg", defaultRegionIds);

    // 2024ë…„ ë””í´íŠ¸ ì„¤ì •
    document.querySelector(".year-select").value = "2024";

    // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸° ê·¸ë˜í”„ ë°ì´í„° ë¡œë“œ (ê¸°ë³¸ "ì„œêµ¬"ì˜ "2024ë…„" "ì›”ë³„" ë°ì´í„°)
    const initialYear = document.querySelector(".year-select").value;
    document.querySelector(".graph-title").textContent = `${initialRegion} ì „ë ¥ ì‚¬ìš©ëŸ‰`; // ì´ˆê¸° ì œëª© ì„¤ì •
    fetchActualData(initialRegion, initialYear);


    document.querySelector(".back-btn").addEventListener("click", () => {
    	// SVG ì»¨í…Œì´ë„ˆ í¬ê¸° ë³µì›
        const svgContainer = document.getElementById("svg-container");
        svgContainer.style.transition = "all 0.2s ease"; // ë¶€ë“œëŸ¬ìš´ ë³µì› íš¨ê³¼
        svgContainer.style.transform = "scale(1)"; // ì›ë˜ í¬ê¸°ë¡œ ë³µì›
      loadRegionSVG("/svg/ëŒ€ì „_í–‰ì •êµ¬ì—­3_ì •ì œë¨.svg", defaultRegionIds);

      // ëŒ€ì „ ì „ì²´ ì§€ë„ë¡œ ëŒì•„ì™”ì„ ë•Œ, ê¸°ë³¸ ì§€ì—­ì˜ ë°ì´í„° ë‹¤ì‹œ ë¡œë“œ (ì˜ˆ: ì„œêµ¬ 2024ë…„ ì›”ë³„ ë°ì´í„°)
      const currentYear = document.querySelector(".year-select").value;
      const activeTabContent = document.querySelector(".tab-btn.active").textContent;

      document.querySelector(".graph-title").textContent = `${initialRegion} ì „ë ¥ ì‚¬ìš©ëŸ‰`; // ì œëª© ë³µì›
      if (activeTabContent === "ì›”ë³„") {
          fetchActualData(initialRegion, currentYear);
      } else if (activeTabContent === "ì˜ˆì¸¡") {
          fetchPredictedData(initialRegion, currentYear);
      }
    });


	// íƒ­ ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€
	const tabButtons = document.querySelectorAll(".tab-btn");
	tabButtons.forEach(button => {
	  button.addEventListener("click", () => {
	    tabButtons.forEach(btn => btn.classList.remove("active"));
	    button.classList.add("active");

	    const yearInput = document.querySelector(".year-select");

	    // âœ… ì˜ˆì¸¡ íƒ­ì¼ ê²½ìš° 2025ë¡œ ê³ ì • + ì½ê¸° ì „ìš© ì„¤ì •
	    if (button.textContent === "ì˜ˆì¸¡") {
	      yearInput.value = "2025";
	      yearInput.setAttribute("readonly", true);
	    } else {
	      // âœ… ì›”ë³„ íƒ­ì¼ ê²½ìš° ì½ê¸° ê°€ëŠ¥í•˜ê²Œ ì„¤ì •
	      yearInput.value = "2024";
	      yearInput.removeAttribute("readonly");
	    }

	    // ì—°ë„ ë³€ê²½ ì´ë²¤íŠ¸ íŠ¸ë¦¬ê±° (ê·¸ë˜í”„ ê°±ì‹ )
	    yearInput.dispatchEvent(new Event("change"));
	  });
	});

    // ì—°ë„ ì„ íƒ ë“œë¡­ë‹¤ìš´ ë³€ê²½ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€
    document.querySelector(".year-select").addEventListener("change", (event) => {
        const selectedYear = event.target.value;
        const currentGraphTitle = document.querySelector(".graph-title").textContent;
        const currentRegion = currentGraphTitle.replace(" ì „ë ¥ ì‚¬ìš©ëŸ‰", "").trim();
        const activeTabContent = document.querySelector(".tab-btn.active").textContent;

        console.log(`ì—°ë„ ë³€ê²½! ì§€ì—­: ${currentRegion}, ìƒˆë¡œìš´ ì—°ë„: ${selectedYear}, íƒ­: ${activeTabContent}`);

		if (currentRegion.endsWith("ë™")) {
		  requestPrediction(currentRegion, selectedYear);
		} else {
		  if (activeTabContent === "ì›”ë³„") {
		    fetchActualData(currentRegion, selectedYear);
		  } else if (activeTabContent === "ì˜ˆì¸¡") {
		    fetchPredictedData(currentRegion, selectedYear);
		  }
		}
    });
  });
</script>
<script>
	function normalizeDongName(dong) {
	  // 'ë²•1ë™', 'íŒì•”2ë™' ë“±ì—ì„œ ìˆ«ì ì œê±° í›„ 'ë²•ë™', 'íŒì•”ë™' ë“±ìœ¼ë¡œ ì •ê·œí™”
	  if (dong === "ì€í–‰ì„ í™”ë™") return "ì„ í™”ë™";
	  return dong.replace(/(\D+)[0-9]+ë™$/, "$1ë™");
	}

	function requestPrediction(dong, year) {
	  const normalizedDong = normalizeDongName(dong);
	  const activeTab = document.querySelector(".tab-btn.active")?.textContent || "ì›”ë³„";

	  console.log("ìš”ì²­ íƒ­:", activeTab);
	  console.log("ìš”ì²­ ë™:", dong, "ì •ê·œí™”:", normalizedDong);
	  console.log("ìš”ì²­ ì—°ë„:", year);

	  const url = activeTab === "ì˜ˆì¸¡"
	    ? "http://192.168.0.15:5000/predict_xgb"
	    : "http://192.168.0.15:5000/predict_real_fee";

	  console.log("ì˜ˆì¸¡ ìš”ì²­ URL:", url);
	  fetch(url, {
	    method: "POST",
	    headers: {
	      "Content-Type": "application/json"
	    },
	    body: JSON.stringify({ dong: normalizedDong, year: parseInt(year) })
	  })
	    .then(res => {
            if (!res.ok) {
                throw new Error(`HTTP error! status: ${res.status}`);
            }
            return res.json();
        })
	    .then(data => {
	      if (data.error) {
	        console.error("ë™ë³„ ì˜ˆì¸¡/ì‹¤ì œ ë°ì´í„° ì˜¤ë¥˜:", data.error);
            renderChart([], []); // ì—ëŸ¬ ë°œìƒ ì‹œ ë¹ˆ ê·¸ë˜í”„
	        alert(`ğŸš§ ${dong} ë°ì´í„°ëŠ” í˜„ì¬ ì¤€ë¹„ ì¤‘ì…ë‹ˆë‹¤. ì¡°ê¸ˆë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”. ğŸš§`);
	      } else {
	        const labels = [];
	        const values = [];

            // 1ì›”ë¶€í„° 12ì›”ê¹Œì§€ ìˆœì„œëŒ€ë¡œ ë°ì´í„°ë¥¼ ì±„ì›ë‹ˆë‹¤.
            for (let i = 1; i <= 12; i++) {
                labels.push(`${i}ì›”`);
                const monthData = data.results.find(item => item.month === i);
                let value = null;
                if (monthData) {
                    value = activeTab === "ì˜ˆì¸¡"
                        ? monthData.xgb_pred ?? null
                        : monthData.real_fee ?? null;
                }
                values.push(value !== null ? value : 0.0); // ë°ì´í„°ê°€ ì—†ìœ¼ë©´ 0.0ìœ¼ë¡œ ì²˜ë¦¬
            }

	        renderChart(labels, values);
	      }
	    })
	    .catch(error => {
	      console.error("ë™ë³„ ì˜ˆì¸¡/ì‹¤ì œ ìš”ì²­ ì‹¤íŒ¨:", error);
	      alert("ì„œë²„ì— ì—°ê²°í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
	      renderChart([], []); // í†µì‹  ì‹¤íŒ¨ ì‹œ ë¹ˆ ê·¸ë˜í”„
	    });
	}

</script>

<div id="tooltip" style="position:absolute; display:none; background:#333; color:#fff; padding:5px 10px; border-radius:4px; font-size:0.9rem; pointer-events: none; z-index: 1000;"></div>
</body>
</html>